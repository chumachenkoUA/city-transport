# 3 ІНФОРМАЦІЙНЕ МОДЕЛЮВАННЯ ПРЕДМЕТНОЇ ОБЛАСТІ

Опис сутностей розглянутої предметної області, їх атрибутів і обмежень представлено в таблиці 3.1.

**Таблиця 3.1 – Опис сутностей предметної області**

| Ім'я атрибута | Призначення атрибута | Обмеження |
|---------------|----------------------|-----------|
| | **users** | |
| id | Ідентифікатор користувача | Первинний ключ, BIGSERIAL |
| login | Логін (PostgreSQL роль) | VARCHAR(50), не порожнє, унікальне |
| email | Електронна пошта | VARCHAR(255), не порожнє, унікальне |
| phone | Номер телефону | VARCHAR(20), не порожнє, унікальне |
| full_name | Повне ім'я користувача | VARCHAR(200), не порожнє |
| registered_at | Дата реєстрації | TIMESTAMP, не порожнє, за замовчуванням now() |
| | **drivers** | |
| id | Ідентифікатор водія | Первинний ключ, BIGSERIAL |
| login | Логін (PostgreSQL роль) | VARCHAR(50), не порожнє, унікальне |
| email | Електронна пошта | VARCHAR(255), не порожнє, унікальне |
| phone | Номер телефону | VARCHAR(20), не порожнє, унікальне |
| full_name | Повне ім'я водія | VARCHAR(200), не порожнє |
| driver_license_number | Номер водійського посвідчення | VARCHAR(20), не порожнє, унікальне |
| license_categories | Категорії прав | JSONB, не порожнє, за замовчуванням [] |
| passport_data | Паспортні дані | JSONB, не порожнє |
| | **transport_types** | |
| id | Ідентифікатор типу транспорту | Первинний ключ, BIGSERIAL |
| name | Назва типу транспорту | VARCHAR(50), не порожнє, унікальне |
| | **vehicle_models** | |
| id | Ідентифікатор моделі | Первинний ключ, SERIAL |
| name | Назва моделі транспорту | VARCHAR(255), не порожнє |
| type_id | Ідентифікатор типу транспорту | INTEGER, зовнішній ключ, не порожнє |
| capacity | Місткість транспорту | INTEGER, не порожнє |
| | **vehicles** | |
| id | Ідентифікатор транспортного засобу | Первинний ключ, BIGSERIAL |
| fleet_number | Бортовий номер | VARCHAR(20), не порожнє, унікальне |
| vehicle_model_id | Ідентифікатор моделі | BIGINT, зовнішній ключ |
| route_id | Ідентифікатор призначеного маршруту | BIGINT, зовнішній ключ, не порожнє |
| | **routes** | |
| id | Ідентифікатор маршруту | Первинний ключ, BIGSERIAL |
| transport_type_id | Ідентифікатор типу транспорту | BIGINT, зовнішній ключ, не порожнє |
| number | Номер маршруту | VARCHAR(10), не порожнє |
| direction | Напрямок руху | VARCHAR(10), не порожнє, CHECK ('forward', 'reverse') |
| is_active | Чи активний маршрут | BOOLEAN, не порожнє, за замовчуванням true |
| | **stops** | |
| id | Ідентифікатор зупинки | Первинний ключ, BIGSERIAL |
| name | Назва зупинки | VARCHAR(200), не порожнє |
| lon | Довгота (longitude) | NUMERIC(10,7), не порожнє, CHECK (-180..180) |
| lat | Широта (latitude) | NUMERIC(10,7), не порожнє, CHECK (-90..90) |
| | **route_stops** | |
| id | Ідентифікатор зв'язку | Первинний ключ, BIGSERIAL |
| route_id | Ідентифікатор маршруту | BIGINT, зовнішній ключ, не порожнє |
| stop_id | Ідентифікатор зупинки | BIGINT, зовнішній ключ, не порожнє |
| prev_route_stop_id | Посилання на попередню зупинку | BIGINT, зовнішній ключ, унікальне |
| next_route_stop_id | Посилання на наступну зупинку | BIGINT, зовнішній ключ, унікальне |
| distance_to_next_km | Відстань до наступної зупинки | NUMERIC(10,3), CHECK >= 0 |
| | **route_points** | |
| id | Ідентифікатор точки маршруту | Первинний ключ, BIGSERIAL |
| route_id | Ідентифікатор маршруту | BIGINT, зовнішній ключ, не порожнє |
| lon | Довгота точки | NUMERIC(10,7), не порожнє, CHECK (-180..180) |
| lat | Широта точки | NUMERIC(10,7), не порожнє, CHECK (-90..90) |
| prev_route_point_id | Посилання на попередню точку | BIGINT, зовнішній ключ, унікальне |
| next_route_point_id | Посилання на наступну точку | BIGINT, зовнішній ключ, унікальне |
| | **schedules** | |
| id | Ідентифікатор розкладу | Первинний ключ, BIGSERIAL |
| route_id | Ідентифікатор маршруту | BIGINT, зовнішній ключ, не порожнє |
| vehicle_id | Ідентифікатор транспорту | BIGINT, зовнішній ключ |
| work_start_time | Час початку роботи | TIME, не порожнє |
| work_end_time | Час завершення роботи | TIME, не порожнє, CHECK > work_start_time |
| interval_min | Інтервал між рейсами (хвилин) | INTEGER, не порожнє, CHECK > 0 |
| monday | Працює в понеділок | BOOLEAN, не порожнє, за замовчуванням false |
| tuesday | Працює у вівторок | BOOLEAN, не порожнє, за замовчуванням false |
| wednesday | Працює в середу | BOOLEAN, не порожнє, за замовчуванням false |
| thursday | Працює в четвер | BOOLEAN, не порожнє, за замовчуванням false |
| friday | Працює в п'ятницю | BOOLEAN, не порожнє, за замовчуванням false |
| saturday | Працює в суботу | BOOLEAN, не порожнє, за замовчуванням false |
| sunday | Працює в неділю | BOOLEAN, не порожнє, за замовчуванням false |
| | **trips** | |
| id | Ідентифікатор рейсу | Первинний ключ, BIGSERIAL |
| route_id | Ідентифікатор маршруту | BIGINT, зовнішній ключ, не порожнє |
| driver_id | Ідентифікатор водія | BIGINT, зовнішній ключ, не порожнє |
| planned_starts_at | Плановий час старту | TIMESTAMP, не порожнє |
| planned_ends_at | Плановий час завершення | TIMESTAMP |
| actual_starts_at | Фактичний час старту | TIMESTAMP |
| actual_ends_at | Фактичний час завершення | TIMESTAMP, CHECK > actual_starts_at |
| status | Статус рейсу | VARCHAR(20), не порожнє, CHECK ('scheduled', 'in_progress', 'completed', 'cancelled') |
| passenger_count | Кількість пасажирів | INTEGER, не порожнє, >= 0, за замовчуванням 0 |
| | **driver_vehicle_assignments** | |
| id | Ідентифікатор призначення | Первинний ключ, BIGSERIAL |
| driver_id | Ідентифікатор водія | BIGINT, зовнішній ключ, не порожнє |
| vehicle_id | Ідентифікатор транспорту | BIGINT, зовнішній ключ, не порожнє |
| assigned_at | Час призначення | TIMESTAMP, не порожнє, за замовчуванням now() |
| | **transport_cards** | |
| id | Ідентифікатор картки | Первинний ключ, BIGSERIAL |
| user_id | Ідентифікатор власника | BIGINT, зовнішній ключ, не порожнє, унікальне |
| balance | Баланс картки | NUMERIC(12,2), не порожнє, >= 0, за замовчуванням 0 |
| card_number | Номер картки | VARCHAR(20), не порожнє, унікальне |
| | **card_top_ups** | |
| id | Ідентифікатор поповнення | Первинний ключ, BIGSERIAL |
| card_id | Ідентифікатор картки | BIGINT, зовнішній ключ, не порожнє |
| amount | Сума поповнення | NUMERIC(12,2), не порожнє, CHECK > 0 |
| topped_up_at | Час поповнення | TIMESTAMP, не порожнє, за замовчуванням now() |
| | **tickets** | |
| id | Ідентифікатор квитка | Первинний ключ, BIGSERIAL |
| trip_id | Ідентифікатор рейсу | BIGINT, зовнішній ключ, не порожнє |
| card_id | Ідентифікатор картки | BIGINT, зовнішній ключ, не порожнє |
| price | Ціна квитка | NUMERIC(12,2), не порожнє, >= 0 |
| purchased_at | Час покупки | TIMESTAMP, не порожнє, за замовчуванням now() |
| | **fines** | |
| id | Ідентифікатор штрафу | Первинний ключ, BIGSERIAL |
| user_id | Ідентифікатор порушника | BIGINT, зовнішній ключ, не порожнє |
| status | Статус штрафу | VARCHAR(50), не порожнє, CHECK ('Очікує сплати', 'В процесі', 'Оплачено', 'Відмінено', 'Прострочено') |
| amount | Сума штрафу | NUMERIC(12,2), не порожнє, CHECK > 0 |
| reason | Причина штрафу | VARCHAR(500), не порожнє |
| issued_by | Логін контролера | VARCHAR(50), не порожнє, за замовчуванням current_user |
| trip_id | Ідентифікатор рейсу | BIGINT, зовнішній ключ, не порожнє |
| issued_at | Час виписання | TIMESTAMP, не порожнє, за замовчуванням now() |
| | **fine_appeals** | |
| id | Ідентифікатор апеляції | Первинний ключ, BIGSERIAL |
| fine_id | Ідентифікатор штрафу | BIGINT, зовнішній ключ, не порожнє, унікальне |
| message | Текст апеляції | VARCHAR(2000), не порожнє |
| status | Статус апеляції | VARCHAR(50), не порожнє, CHECK ('Подано', 'Перевіряється', 'Відхилено', 'Прийнято') |
| created_at | Дата подання | TIMESTAMP, не порожнє, за замовчуванням now() |
| | **complaints_suggestions** | |
| id | Ідентифікатор звернення | Первинний ключ, BIGSERIAL |
| user_id | Ідентифікатор автора | BIGINT, зовнішній ключ |
| type | Тип звернення | VARCHAR(50), не порожнє |
| message | Текст звернення | VARCHAR(2000), не порожнє |
| trip_id | Ідентифікатор рейсу | BIGINT, зовнішній ключ |
| route_id | Ідентифікатор маршруту | INTEGER, зовнішній ключ |
| vehicle_id | Ідентифікатор транспорту | BIGINT, зовнішній ключ |
| contact_info | Контактна інформація | VARCHAR(200) |
| status | Статус звернення | VARCHAR(50), не порожнє, CHECK ('Подано', 'Розглядається', 'Розглянуто') |
| created_at | Дата створення | TIMESTAMP, не порожнє, за замовчуванням now() |
| | **user_gps_logs** | |
| id | Ідентифікатор запису GPS | Первинний ключ, BIGSERIAL |
| user_id | Ідентифікатор користувача | BIGINT, зовнішній ключ, не порожнє |
| lon | Довгота | NUMERIC(10,7), не порожнє, CHECK (-180..180) |
| lat | Широта | NUMERIC(10,7), не порожнє, CHECK (-90..90) |
| recorded_at | Час запису | TIMESTAMP, не порожнє, за замовчуванням now() |
| | **vehicle_gps_logs** | |
| id | Ідентифікатор запису GPS | Первинний ключ, BIGSERIAL |
| vehicle_id | Ідентифікатор транспорту | BIGINT, зовнішній ключ, не порожнє |
| lon | Довгота | NUMERIC(10,7), не порожнє, CHECK (-180..180) |
| lat | Широта | NUMERIC(10,7), не порожнє, CHECK (-90..90) |
| recorded_at | Час запису | TIMESTAMP, не порожнє, за замовчуванням now() |
| | **budgets** | |
| id | Ідентифікатор бюджету | Первинний ключ, BIGSERIAL |
| month | Місяць бюджету | DATE, не порожнє, унікальне |
| planned_income | Плановий дохід | NUMERIC(14,2), не порожнє, >= 0, за замовчуванням 0 |
| planned_expenses | Планові витрати | NUMERIC(14,2), не порожнє, >= 0, за замовчуванням 0 |
| actual_income | Фактичний дохід | NUMERIC(14,2), не порожнє, >= 0, за замовчуванням 0 |
| actual_expenses | Фактичні витрати | NUMERIC(14,2), не порожнє, >= 0, за замовчуванням 0 |
| note | Примітка | VARCHAR(500) |
| | **incomes** | |
| id | Ідентифікатор доходу | Первинний ключ, BIGSERIAL |
| source | Джерело доходу | VARCHAR(50), не порожнє, CHECK ('government', 'tickets', 'fines', 'other') |
| amount | Сума доходу | NUMERIC(12,2), не порожнє, CHECK > 0 |
| description | Опис | VARCHAR(500) |
| document_ref | Номер документа | VARCHAR(100) |
| received_at | Дата отримання | TIMESTAMP, не порожнє, за замовчуванням now() |
| | **expenses** | |
| id | Ідентифікатор витрати | Первинний ключ, BIGSERIAL |
| category | Категорія витрати | VARCHAR(100), не порожнє |
| amount | Сума витрати | NUMERIC(12,2), не порожнє, CHECK > 0 |
| description | Опис | VARCHAR(500) |
| occurred_at | Дата витрати | TIMESTAMP, не порожнє, за замовчуванням now() |
| document_ref | Номер документа | VARCHAR(100) |
| | **salary_payments** | |
| id | Ідентифікатор виплати | Первинний ключ, BIGSERIAL |
| driver_id | Ідентифікатор водія | BIGINT, зовнішній ключ, не порожнє |
| rate | Ставка за одиницю | NUMERIC(12,2), CHECK > 0 або null |
| units | Кількість одиниць | INTEGER, CHECK > 0 або null |
| total | Загальна сума виплати | NUMERIC(12,2), не порожнє, CHECK > 0 |
| paid_at | Дата виплати | TIMESTAMP, не порожнє, за замовчуванням now() |

## Опис зв'язків між сутностями

1) **Зв'язок між типами транспорту та маршрутами.** Один тип транспорту (автобус, тролейбус, трамвай) може мати багато маршрутів. З іншого боку, кожен маршрут належить до одного конкретного типу транспорту. Отже, між сутностями transport_types та routes існує зв'язок один-до-багатьох. Для формалізації цього зв'язку первинний ключ таблиці типів транспорту доданий до таблиці маршрутів у якості зовнішнього ключа.

2) **Зв'язок між типами транспорту та моделями.** Один тип транспорту може мати багато різних моделей (наприклад, автобуси ЛАЗ, Богдан, Електрон). З іншого боку, кожна модель належить до одного типу транспорту. Отже, між сутностями transport_types та vehicle_models існує зв'язок один-до-багатьох.

3) **Зв'язок між моделями та транспортними засобами.** Одна модель транспорту може бути представлена багатьма конкретними транспортними засобами. З іншого боку, кожен транспортний засіб є екземпляром однієї конкретної моделі. Отже, між сутностями vehicle_models та vehicles існує зв'язок один-до-багатьох.

4) **Зв'язок між маршрутами та транспортом.** Один маршрут обслуговується багатьма транспортними засобами. З іншого боку, кожен транспортний засіб призначений на один конкретний маршрут. Отже, між сутностями routes та vehicles існує зв'язок один-до-багатьох.

5) **Зв'язок між маршрутами та зупинками.** Один маршрут проходить через багато зупинок. З іншого боку, одна зупинка може належати до багатьох різних маршрутів. Отже, між сутностями routes та stops існує зв'язок багато-до-багатьох. Для формалізації цього зв'язку створена проміжна таблиця route_stops, яка зберігає пари ідентифікаторів маршруту та зупинки з додатковою інформацією про порядок та відстань.

6) **Зв'язок між маршрутами та точками маршруту.** Один маршрут має багато GPS-точок для відображення геометрії на карті. З іншого боку, кожна точка належить одному конкретному маршруту. Отже, між сутностями routes та route_points існує зв'язок один-до-багатьох. Ідентифікатор маршруту додається до таблиці точок як зовнішній ключ.

7) **Зв'язок між маршрутами та розкладами.** Один маршрут може мати багато записів розкладу (на різні дні та транспортні засоби). З іншого боку, кожен запис розкладу стосується одного конкретного маршруту. Отже, між сутностями routes та schedules існує зв'язок один-до-багатьох.

8) **Зв'язок між маршрутами та рейсами.** Один маршрут має багато рейсів (кожен виїзд транспорту). З іншого боку, кожен рейс виконується по одному конкретному маршруту. Отже, між сутностями routes та trips існує зв'язок один-до-багатьох.

9) **Зв'язок між водіями та рейсами.** Один водій може виконувати багато рейсів (в різний час). З іншого боку, кожен рейс виконується одним конкретним водієм. Отже, між сутностями drivers та trips існує зв'язок один-до-багатьох. Додатково існує обмеження: один водій може мати тільки один активний рейс одночасно (реалізовано через частковий унікальний індекс).

10) **Зв'язок між водіями та транспортом.** Один водій може працювати на різних транспортних засобах (в різний час). З іншого боку, один транспортний засіб може керуватися різними водіями. Отже, між сутностями drivers та vehicles існує зв'язок багато-до-багатьох. Для формалізації цього зв'язку створена проміжна таблиця driver_vehicle_assignments з фіксацією часу призначення.

11) **Зв'язок між транспортом та GPS-логами.** Один транспортний засіб може мати багато записів GPS-позицій (для відстеження в реальному часі). З іншого боку, кожен запис GPS належить одному конкретному транспорту. Отже, між сутностями vehicles та vehicle_gps_logs існує зв'язок один-до-багатьох.

12) **Зв'язок між користувачами та транспортними картками.** Один користувач має одну транспортну картку. Отже, між сутностями users та transport_cards існує зв'язок один-до-одного, реалізований через унікальний зовнішній ключ user_id.

13) **Зв'язок між транспортними картками та поповненнями.** Одна картка може мати багато записів поповнення. З іншого боку, кожне поповнення стосується однієї конкретної картки. Отже, між сутностями transport_cards та card_top_ups існує зв'язок один-до-багатьох.

14) **Зв'язок між транспортними картками та квитками.** Одна картка може бути використана для купівлі багатьох квитків. З іншого боку, кожен квиток куплений з однієї конкретної картки. Отже, між сутностями transport_cards та tickets існує зв'язок один-до-багатьох.

15) **Зв'язок між рейсами та квитками.** Один рейс може мати багато проданих квитків. З іншого боку, кожен квиток прив'язаний до одного конкретного рейсу. Отже, між сутностями trips та tickets існує зв'язок один-до-багатьох.

16) **Зв'язок між користувачами та штрафами.** Один користувач може мати багато штрафів. З іншого боку, кожен штраф виписаний одному конкретному користувачу. Отже, між сутностями users та fines існує зв'язок один-до-багатьох.

17) **Зв'язок між рейсами та штрафами.** Один рейс може мати багато виписаних штрафів. З іншого боку, кожен штраф виписується під час одного конкретного рейсу. Отже, між сутностями trips та fines існує зв'язок один-до-багатьох.

18) **Зв'язок між штрафами та апеляціями.** Один штраф може мати максимум одну апеляцію. Отже, між сутностями fines та fine_appeals існує зв'язок один-до-одного, реалізований через унікальний зовнішній ключ fine_id.

19) **Зв'язок між користувачами та GPS-логами.** Один користувач може мати багато записів GPS-позицій. З іншого боку, кожен запис GPS належить одному конкретному користувачу. Отже, між сутностями users та user_gps_logs існує зв'язок один-до-багатьох.

20) **Зв'язок між користувачами та зверненнями.** Один користувач може подати багато скарг та пропозицій. З іншого боку, кожне звернення подається одним конкретним користувачем (або анонімно). Отже, між сутностями users та complaints_suggestions існує зв'язок один-до-багатьох.

21) **Зв'язок між водіями та виплатами зарплати.** Один водій може мати багато виплат зарплати (за різні періоди). З іншого боку, кожна виплата прив'язана до одного конкретного водія. Отже, між сутностями drivers та salary_payments існує зв'язок один-до-багатьох.

Усі таблиці знаходяться у нормальній формі Бойса-Кодда (НФБК). Схему бази даних, що ілюструє сутності та зв'язки між ними, наведено в додатку А (рис. А.1).
