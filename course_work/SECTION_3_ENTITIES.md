# 3 ІНФОРМАЦІЙНЕ МОДЕЛЮВАННЯ ПРЕДМЕТНОЇ ОБЛАСТІ

Опис сутностей розглянутої предметної області, їх атрибутів і обмежень представлено в таблиці 3.1.

**Таблиця 3.1 – Опис сутностей предметної області**

| Ім'я атрибута | Призначення атрибута | Обмеження |
|---------------|----------------------|-----------|
| | **users** | |
| id | Ідентифікатор користувача | PK |
| login | Логін (PostgreSQL роль) | До 50 символів, обов'язкове, унікальне |
| email | Електронна пошта | До 255 символів, обов'язкове, унікальне |
| phone | Номер телефону | До 20 символів, обов'язкове, унікальне |
| full_name | Повне ім'я користувача | До 200 символів, обов'язкове |
| registered_at | Дата реєстрації | Обов'язкове, за замовчуванням поточний час |
| | **drivers** | |
| id | Ідентифікатор водія | PK |
| login | Логін (PostgreSQL роль) | До 50 символів, обов'язкове, унікальне |
| email | Електронна пошта | До 255 символів, обов'язкове, унікальне |
| phone | Номер телефону | До 20 символів, обов'язкове, унікальне |
| full_name | Повне ім'я водія | До 200 символів, обов'язкове |
| driver_license_number | Номер водійського посвідчення | До 20 символів, обов'язкове, унікальне |
| license_categories | Категорії прав | JSON масив, обов'язкове, за замовчуванням [] |
| passport_data | Паспортні дані | JSON об'єкт, обов'язкове |
| | **transport_types** | |
| id | Ідентифікатор типу транспорту | PK |
| name | Назва типу транспорту | До 50 символів, обов'язкове, унікальне |
| | **vehicle_models** | |
| id | Ідентифікатор моделі | PK |
| name | Назва моделі транспорту | До 255 символів, обов'язкове |
| type_id | Ідентифікатор типу транспорту | FK, обов'язкове |
| capacity | Місткість транспорту | Обов'язкове |
| | **vehicles** | |
| id | Ідентифікатор транспортного засобу | PK |
| fleet_number | Бортовий номер | До 20 символів, обов'язкове, унікальне |
| vehicle_model_id | Ідентифікатор моделі | FK |
| route_id | Ідентифікатор призначеного маршруту | FK, обов'язкове |
| | **routes** | |
| id | Ідентифікатор маршруту | PK |
| transport_type_id | Ідентифікатор типу транспорту | FK, обов'язкове |
| number | Номер маршруту | До 10 символів, обов'язкове |
| direction | Напрямок руху | До 10 символів, обов'язкове, значення: 'forward' або 'reverse' |
| is_active | Чи активний маршрут | Обов'язкове, за замовчуванням true |
| | **stops** | |
| id | Ідентифікатор зупинки | PK |
| name | Назва зупинки | До 200 символів, обов'язкове |
| lon | Довгота (longitude) | Обов'язкове, значення від -180 до 180 |
| lat | Широта (latitude) | Обов'язкове, значення від -90 до 90 |
| | **route_stops** | |
| id | Ідентифікатор зв'язку | PK |
| route_id | Ідентифікатор маршруту | FK, обов'язкове |
| stop_id | Ідентифікатор зупинки | FK, обов'язкове |
| prev_route_stop_id | Посилання на попередню зупинку | FK, унікальне |
| next_route_stop_id | Посилання на наступну зупинку | FK, унікальне |
| distance_to_next_km | Відстань до наступної зупинки | Значення не менше 0 |
| | **route_points** | |
| id | Ідентифікатор точки маршруту | PK |
| route_id | Ідентифікатор маршруту | FK, обов'язкове |
| lon | Довгота точки | Обов'язкове, значення від -180 до 180 |
| lat | Широта точки | Обов'язкове, значення від -90 до 90 |
| prev_route_point_id | Посилання на попередню точку | FK, унікальне |
| next_route_point_id | Посилання на наступну точку | FK, унікальне |
| | **schedules** | |
| id | Ідентифікатор розкладу | PK |
| route_id | Ідентифікатор маршруту | FK, обов'язкове |
| vehicle_id | Ідентифікатор транспорту | FK |
| work_start_time | Час початку роботи | Обов'язкове |
| work_end_time | Час завершення роботи | Обов'язкове, більше ніж work_start_time |
| interval_min | Інтервал між рейсами (хвилин) | Обов'язкове, значення більше 0 |
| monday | Працює в понеділок | Обов'язкове, за замовчуванням false |
| tuesday | Працює у вівторок | Обов'язкове, за замовчуванням false |
| wednesday | Працює в середу | Обов'язкове, за замовчуванням false |
| thursday | Працює в четвер | Обов'язкове, за замовчуванням false |
| friday | Працює в п'ятницю | Обов'язкове, за замовчуванням false |
| saturday | Працює в суботу | Обов'язкове, за замовчуванням false |
| sunday | Працює в неділю | Обов'язкове, за замовчуванням false |
| | **trips** | |
| id | Ідентифікатор рейсу | PK |
| route_id | Ідентифікатор маршруту | FK, обов'язкове |
| driver_id | Ідентифікатор водія | FK, обов'язкове |
| planned_starts_at | Плановий час старту | Обов'язкове |
| planned_ends_at | Плановий час завершення | |
| actual_starts_at | Фактичний час старту | |
| actual_ends_at | Фактичний час завершення | Більше ніж actual_starts_at |
| status | Статус рейсу | До 20 символів, обов'язкове, значення: 'scheduled', 'in_progress', 'completed', 'cancelled' |
| passenger_count | Кількість пасажирів | Обов'язкове, значення не менше 0, за замовчуванням 0 |
| | **driver_vehicle_assignments** | |
| id | Ідентифікатор призначення | PK |
| driver_id | Ідентифікатор водія | FK, обов'язкове |
| vehicle_id | Ідентифікатор транспорту | FK, обов'язкове |
| assigned_at | Час призначення | Обов'язкове, за замовчуванням поточний час |
| | **transport_cards** | |
| id | Ідентифікатор картки | PK |
| user_id | Ідентифікатор власника | FK, обов'язкове, унікальне |
| balance | Баланс картки | Обов'язкове, значення не менше 0, за замовчуванням 0 |
| card_number | Номер картки | До 20 символів, обов'язкове, унікальне |
| | **card_top_ups** | |
| id | Ідентифікатор поповнення | PK |
| card_id | Ідентифікатор картки | FK, обов'язкове |
| amount | Сума поповнення | Обов'язкове, значення більше 0 |
| topped_up_at | Час поповнення | Обов'язкове, за замовчуванням поточний час |
| | **tickets** | |
| id | Ідентифікатор квитка | PK |
| trip_id | Ідентифікатор рейсу | FK, обов'язкове |
| card_id | Ідентифікатор картки | FK, обов'язкове |
| price | Ціна квитка | Обов'язкове, значення не менше 0 |
| purchased_at | Час покупки | Обов'язкове, за замовчуванням поточний час |
| | **fines** | |
| id | Ідентифікатор штрафу | PK |
| user_id | Ідентифікатор порушника | FK, обов'язкове |
| status | Статус штрафу | До 50 символів, обов'язкове, значення: 'Очікує сплати', 'В процесі', 'Оплачено', 'Відмінено', 'Прострочено' |
| amount | Сума штрафу | Обов'язкове, значення більше 0 |
| reason | Причина штрафу | До 500 символів, обов'язкове |
| issued_by | Логін контролера | До 50 символів, обов'язкове, за замовчуванням поточний користувач |
| trip_id | Ідентифікатор рейсу | FK, обов'язкове |
| issued_at | Час виписання | Обов'язкове, за замовчуванням поточний час |
| | **fine_appeals** | |
| id | Ідентифікатор апеляції | PK |
| fine_id | Ідентифікатор штрафу | FK, обов'язкове, унікальне |
| message | Текст апеляції | До 2000 символів, обов'язкове |
| status | Статус апеляції | До 50 символів, обов'язкове, значення: 'Подано', 'Перевіряється', 'Відхилено', 'Прийнято' |
| created_at | Дата подання | Обов'язкове, за замовчуванням поточний час |
| | **complaints_suggestions** | |
| id | Ідентифікатор звернення | PK |
| user_id | Ідентифікатор автора | FK |
| type | Тип звернення | До 50 символів, обов'язкове |
| message | Текст звернення | До 2000 символів, обов'язкове |
| trip_id | Ідентифікатор рейсу | FK |
| route_id | Ідентифікатор маршруту | FK |
| vehicle_id | Ідентифікатор транспорту | FK |
| contact_info | Контактна інформація | До 200 символів |
| status | Статус звернення | До 50 символів, обов'язкове, значення: 'Подано', 'Розглядається', 'Розглянуто' |
| created_at | Дата створення | Обов'язкове, за замовчуванням поточний час |
| | **user_gps_logs** | |
| id | Ідентифікатор запису GPS | PK |
| user_id | Ідентифікатор користувача | FK, обов'язкове |
| lon | Довгота | Обов'язкове, значення від -180 до 180 |
| lat | Широта | Обов'язкове, значення від -90 до 90 |
| recorded_at | Час запису | Обов'язкове, за замовчуванням поточний час |
| | **vehicle_gps_logs** | |
| id | Ідентифікатор запису GPS | PK |
| vehicle_id | Ідентифікатор транспорту | FK, обов'язкове |
| lon | Довгота | Обов'язкове, значення від -180 до 180 |
| lat | Широта | Обов'язкове, значення від -90 до 90 |
| recorded_at | Час запису | Обов'язкове, за замовчуванням поточний час |
| | **budgets** | |
| id | Ідентифікатор бюджету | PK |
| month | Місяць бюджету | Обов'язкове, унікальне |
| planned_income | Плановий дохід | Обов'язкове, значення не менше 0, за замовчуванням 0 |
| planned_expenses | Планові витрати | Обов'язкове, значення не менше 0, за замовчуванням 0 |
| actual_income | Фактичний дохід | Обов'язкове, значення не менше 0, за замовчуванням 0 |
| actual_expenses | Фактичні витрати | Обов'язкове, значення не менше 0, за замовчуванням 0 |
| note | Примітка | До 500 символів |
| | **incomes** | |
| id | Ідентифікатор доходу | PK |
| source | Джерело доходу | До 50 символів, обов'язкове, значення: 'government', 'tickets', 'fines', 'other' |
| amount | Сума доходу | Обов'язкове, значення більше 0 |
| description | Опис | До 500 символів |
| document_ref | Номер документа | До 100 символів |
| received_at | Дата отримання | Обов'язкове, за замовчуванням поточний час |
| | **expenses** | |
| id | Ідентифікатор витрати | PK |
| category | Категорія витрати | До 100 символів, обов'язкове |
| amount | Сума витрати | Обов'язкове, значення більше 0 |
| description | Опис | До 500 символів |
| occurred_at | Дата витрати | Обов'язкове, за замовчуванням поточний час |
| document_ref | Номер документа | До 100 символів |
| | **salary_payments** | |
| id | Ідентифікатор виплати | PK |
| driver_id | Ідентифікатор водія | FK, обов'язкове |
| rate | Ставка за одиницю | Значення більше 0 |
| units | Кількість одиниць | Значення більше 0 |
| total | Загальна сума виплати | Обов'язкове, значення більше 0 |
| paid_at | Дата виплати | Обов'язкове, за замовчуванням поточний час |

## Опис зв'язків між сутностями

1) **Зв'язок між типами транспорту та маршрутами.** Один тип транспорту (автобус, тролейбус, трамвай) може мати багато маршрутів. З іншого боку, кожен маршрут належить до одного конкретного типу транспорту. Отже, між сутностями transport_types та routes існує зв'язок один-до-багатьох. Для формалізації цього зв'язку первинний ключ таблиці типів транспорту доданий до таблиці маршрутів у якості зовнішнього ключа.

2) **Зв'язок між типами транспорту та моделями.** Один тип транспорту може мати багато різних моделей (наприклад, автобуси ЛАЗ, Богдан, Електрон). З іншого боку, кожна модель належить до одного типу транспорту. Отже, між сутностями transport_types та vehicle_models існує зв'язок один-до-багатьох.

3) **Зв'язок між моделями та транспортними засобами.** Одна модель транспорту може бути представлена багатьма конкретними транспортними засобами. З іншого боку, кожен транспортний засіб є екземпляром однієї конкретної моделі. Отже, між сутностями vehicle_models та vehicles існує зв'язок один-до-багатьох.

4) **Зв'язок між маршрутами та транспортом.** Один маршрут обслуговується багатьма транспортними засобами. З іншого боку, кожен транспортний засіб призначений на один конкретний маршрут. Отже, між сутностями routes та vehicles існує зв'язок один-до-багатьох.

5) **Зв'язок між маршрутами та зупинками.** Один маршрут проходить через багато зупинок. З іншого боку, одна зупинка може належати до багатьох різних маршрутів. Отже, між сутностями routes та stops існує зв'язок багато-до-багатьох. Для формалізації цього зв'язку створена проміжна таблиця route_stops, яка зберігає пари ідентифікаторів маршруту та зупинки з додатковою інформацією про порядок та відстань.

6) **Зв'язок між маршрутами та точками маршруту.** Один маршрут має багато GPS-точок для відображення геометрії на карті. З іншого боку, кожна точка належить одному конкретному маршруту. Отже, між сутностями routes та route_points існує зв'язок один-до-багатьох. Ідентифікатор маршруту додається до таблиці точок як зовнішній ключ.

7) **Зв'язок між маршрутами та розкладами.** Один маршрут може мати багато записів розкладу (на різні дні та транспортні засоби). З іншого боку, кожен запис розкладу стосується одного конкретного маршруту. Отже, між сутностями routes та schedules існує зв'язок один-до-багатьох.

8) **Зв'язок між маршрутами та рейсами.** Один маршрут має багато рейсів (кожен виїзд транспорту). З іншого боку, кожен рейс виконується по одному конкретному маршруту. Отже, між сутностями routes та trips існує зв'язок один-до-багатьох.

9) **Зв'язок між водіями та рейсами.** Один водій може виконувати багато рейсів (в різний час). З іншого боку, кожен рейс виконується одним конкретним водієм. Отже, між сутностями drivers та trips існує зв'язок один-до-багатьох. Додатково існує обмеження: один водій може мати тільки один активний рейс одночасно (реалізовано через частковий унікальний індекс).

10) **Зв'язок між водіями та транспортом.** Один водій може працювати на різних транспортних засобах (в різний час). З іншого боку, один транспортний засіб може керуватися різними водіями. Отже, між сутностями drivers та vehicles існує зв'язок багато-до-багатьох. Для формалізації цього зв'язку створена проміжна таблиця driver_vehicle_assignments з фіксацією часу призначення.

11) **Зв'язок між транспортом та GPS-логами.** Один транспортний засіб може мати багато записів GPS-позицій (для відстеження в реальному часі). З іншого боку, кожен запис GPS належить одному конкретному транспорту. Отже, між сутностями vehicles та vehicle_gps_logs існує зв'язок один-до-багатьох.

12) **Зв'язок між користувачами та транспортними картками.** Один користувач має одну транспортну картку. Отже, між сутностями users та transport_cards існує зв'язок один-до-одного, реалізований через унікальний зовнішній ключ user_id.

13) **Зв'язок між транспортними картками та поповненнями.** Одна картка може мати багато записів поповнення. З іншого боку, кожне поповнення стосується однієї конкретної картки. Отже, між сутностями transport_cards та card_top_ups існує зв'язок один-до-багатьох.

14) **Зв'язок між транспортними картками та квитками.** Одна картка може бути використана для купівлі багатьох квитків. З іншого боку, кожен квиток куплений з однієї конкретної картки. Отже, між сутностями transport_cards та tickets існує зв'язок один-до-багатьох.

15) **Зв'язок між рейсами та квитками.** Один рейс може мати багато проданих квитків. З іншого боку, кожен квиток прив'язаний до одного конкретного рейсу. Отже, між сутностями trips та tickets існує зв'язок один-до-багатьох.

16) **Зв'язок між користувачами та штрафами.** Один користувач може мати багато штрафів. З іншого боку, кожен штраф виписаний одному конкретному користувачу. Отже, між сутностями users та fines існує зв'язок один-до-багатьох.

17) **Зв'язок між рейсами та штрафами.** Один рейс може мати багато виписаних штрафів. З іншого боку, кожен штраф виписується під час одного конкретного рейсу. Отже, між сутностями trips та fines існує зв'язок один-до-багатьох.

18) **Зв'язок між штрафами та апеляціями.** Один штраф може мати максимум одну апеляцію. Отже, між сутностями fines та fine_appeals існує зв'язок один-до-одного, реалізований через унікальний зовнішній ключ fine_id.

19) **Зв'язок між користувачами та GPS-логами.** Один користувач може мати багато записів GPS-позицій. З іншого боку, кожен запис GPS належить одному конкретному користувачу. Отже, між сутностями users та user_gps_logs існує зв'язок один-до-багатьох.

20) **Зв'язок між користувачами та зверненнями.** Один користувач може подати багато скарг та пропозицій. З іншого боку, кожне звернення подається одним конкретним користувачем (або анонімно). Отже, між сутностями users та complaints_suggestions існує зв'язок один-до-багатьох.

21) **Зв'язок між водіями та виплатами зарплати.** Один водій може мати багато виплат зарплати (за різні періоди). З іншого боку, кожна виплата прив'язана до одного конкретного водія. Отже, між сутностями drivers та salary_payments існує зв'язок один-до-багатьох.

Усі таблиці знаходяться у нормальній формі Бойса-Кодда (НФБК). Схему бази даних, що ілюструє сутності та зв'язки між ними, наведено в додатку А (рис. А.1).
